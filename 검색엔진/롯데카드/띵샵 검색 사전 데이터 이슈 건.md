어제 띵샵 사전 데이터 반영 이후 발생한 검색 성능 저하 및 결과 품질 저하 이슈와 관련하여 아래와 같이 확인된 사항과 향후 개선 방향에 대해 검토 중인 내용을 공유드립니다.

## 1. 이슈 원인 분석

현재 띵샵 인덱스는 사용자 정의 사전(`user_dictionary_rules`)을 **settings에 직접 입력하는 방식**으로 구성되어 있습니다. 어제 약 60,000건 규모의 신규 사전이 해당 설정에 포함되면서 다음과 같은 문제가 발생했을 걸로 예상합니다.

예상되는 문제
- **클러스터 상태(Cluster State) 증가**: 대용량 설정 데이터가 클러스터 상태에 직접 반영되면서, 검색 요청 시 클러스터 상태 참조 시간이 늘어나 검색 속도가 저하되었습니다.

---

## 2. 개선 방향 (검토 중)

안정적인 검색 성능 유지 및 운영 유연성 확보를 위해, 사용자 정의 사전 적용 방식을 **외부 사전 파일 참조 방식**으로 전환하는 방안을 검토 중입니다.

### 제안 방식: 외부 사전 파일(`userdict.txt`) 참조 방식

- 기존처럼 settings에 직접 입력하지 않고, `$ES_HOME/config/userdict.txt` 경로에 사전 파일을 위치시키고 해당 경로를 tokenizer 설정에서 참조합니다.
    
- 장점:
    
    - 클러스터 상태에 영향을 주지 않음
        
    - settings 변경 없이 사전 파일만 교체하면 적용 가능
        
    - 검색 인덱스 재생성 없이 운영 중에도 대응 가능
        
    - 사전 변경에 따른 인덱스 불안정성 감소
        

---

## 3. 향후 계획

현재 위 개선 방향에 대한 검토와 테스트를 진행 중이며, 적용 시 예상 효과와 위험 요소를 함께 분석하고 있습니다. 검토가 완료되는 대로 결과를 공유드리고, 적용 가능 일정 및 방식에 대해서도 별도 안내드리겠습니다.