다음은 **대량 사용자 사전 적용 여부에 따른 OpenSearch 쿼리 성능 비교 보고서**입니다. 

첫 번 테스트는 대량 사용자 사전이 설정된 상태에서 진행되었고, 두 번째 테스트는 사전이 미적용된 인덱스입니다,

# 대량 사전 적용 여부에 따른 쿼리 성능 비교 보고서

- **대상 인덱스**: `osstem-stg-goods-ko`
    
- **총 요청 수**: 병렬 5,000회 / 순차 200회
    
- **최대 동시 실행 수**: 20
    
- **비교 목적**: 동일 쿼리에 대해 대량 사용자 사전 적용 여부에 따른 성능 차이 분석
    

---

## 테스트 시나리오 개요

|항목|첫 번째 테스트|두 번째 테스트|
|---|---|---|
|사용자 사전|대량 사전 포함|사전 미포함 또는 간소화|
|테스트 환경|실서비스 유사 환경|동일 환경 또는 별도 테스트 노드|
|Query 1|상품 검색 쿼리|동일|
|Query 2|전체 검색 쿼리|동일|

---

## 병렬 테스트 (5,000회 요청) 성능 비교

|항목|Query|대량 사전 포함|사전 미포함|개선 효과|
|---|---|---|---|---|
|총 실행 시간|Q1|24.45초|16.95초|30.7% 감소|
||Q2|16.15초|13.57초|16.0% 감소|
|초당 요청 수 (RPS)|Q1|204.51|295.04|44.3% 증가|
||Q2|309.64|368.46|19.0% 증가|
|OpenSearch took 평균 (ms)|Q1|42.21|21.23|49.7% 감소|
||Q2|5.32|5.83|9.6% 증가 (미미)|
|전체 응답 시간 평균 (ms)|Q1|96.97|67.00|30.9% 감소|
||Q2|64.09|53.80|16.0% 감소|
|Query Profile 평균 (ms)|Q1|12.97|8.96|30.9% 감소|
||Q2|2.13|1.86|12.7% 감소|

---

## 순차 테스트 (200회 요청) 성능 비교

|항목|Query|대량 사전 포함|사전 미포함|개선 효과|
|---|---|---|---|---|
|총 실행 시간|Q1|6.70초|5.71초|14.8% 감소|
||Q2|8.74초|4.09초|53.2% 감소|
|OpenSearch took 평균 (ms)|Q1|8.24|7.10|13.8% 감소|
||Q2|1.18|1.31|11.0% 증가 (미미)|
|전체 응답 시간 평균 (ms)|Q1|31.89|27.09|15.1% 감소|
||Q2|42.98|19.86|53.8% 감소|
|Query Profile 평균 (ms)|Q1|3.63|3.03|16.5% 감소|
||Q2|1.12|1.15|2.6% 증가 (미미)|

---

## 분석 요약

### 성능 개선 포인트

- Query 1(상품 검색)에서 대량 사전 제거 시 병렬 처리 환경에서 초당 요청 처리량(RPS)은 약 44% 증가하였고, 전체 응답 시간은 31% 감소하였습니다.
    
- Query 2(전체 검색)에서도 RPS는 19% 증가, 응답 시간은 16% 감소하였으며, 순차 테스트에서는 최대 53% 수준의 응답시간 단축 효과가 확인되었습니다.
    
- Query Profile 시간 또한 전체적으로 10~30% 가량 단축되었으며, 이는 분석기 동작에서의 연산 비용이 줄어든 것을 의미합니다.
    

### 유의사항

- Query 2는 `terms` 기반으로 분석기 영향을 거의 받지 않아 사전 적용 여부에 따른 차이가 미미합니다.
    
- 반면 Query 1은 `query_string` 기반으로 분석기를 통해 텍스트 토큰화 과정을 거치며, 대량 사전이 포함된 경우 성능 저하가 뚜렷하게 나타납니다. 특히 병렬 환경에서는 이 영향이 더욱 크게 작용합니다.
    

---

## 결론 및 권장 사항

|항목|권장 사항|
|---|---|
|대량 사전 구성|사용자 사전은 분석기 설정에 직접 포함시키기보다는 외부 텍스트 파일(`user_dictionary`)로 관리하고, 필요 시에만 로드하도록 구성하는 것이 좋습니다.|
|상품명 기반 검색 등 분석기 의존이 높은 필드|대량 사전을 최소화하거나, 별도의 전처리된 키워드 방식으로 분리 관리하는 구조가 효율적입니다.|
|실시간 검색 API|분석기 영향이 적은 `terms` 쿼리 중심의 설계가 실시간 처리 성능에 유리합니다.|
|사전 적용이 불가피한 경우|OpenSearch 분석기 내 settings에 직접 입력하는 방식은 지양하고, 텍스트 파일 연동 방식(`user_dictionary_rules_path`)을 사용하는 구조로 전환하는 것이 바람직합니다. 이 방식은 클러스터의 설정 무게를 줄이고 재시작 없이도 관리가 용이합니다.|

---

필요 시 이 보고서는 PPT, PDF, Markdown 등 다양한 형식으로 변환해드릴 수 있습니다. 요청하시면 바로 제공해드립니다.